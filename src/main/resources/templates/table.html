<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=emulateIE7" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<link rel="stylesheet" type="text/css" th:href="@{/css/style.css}" />
<link rel="stylesheet" type="text/css" th:href="@{/css/WdatePicker.css}" />
<link rel="stylesheet" type="text/css" th:href="@{/css/skin_/table.css}" />
<link rel="stylesheet" type="text/css" th:href="@{/css/jquery.grid.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/layui/css/layui.css}" >
    <style type="text/css">
        .search input{

            height: 20px;
            margin-bottom: 10px;
        }
        .search{
            display: none;
        }
       th div, td div{
            text-align: center;
        }
        td{
            text-align: center;
        }
    </style>
    <script th:src="@{/layui/layui.js}"></script>


<title>表格</title>
</head>

<body>
<div id="container">
	<div id="hd"></div>
    <div id="bd">
    	<div id="main">
        	<!--<div class="search-box ue-clear">
            	<div class="search-area">
                    <div class="kv-item ue-clear">
                        <label>选择时间：</label>
                        <div class="kv-item-content ue-clear">
                            <span class="choose">
                                <span class="checkboxouter">
                                    <input type="radio" name="time" />
                                    <span class="radio"></span>
                                </span>
                                <span class="text">全部</span>
                            </span>
                            <span class="choose">
                                <span class="checkboxouter">
                                    <input type="radio" name="time" />
                                    <span class="radio"></span>
                                </span>
                                <span class="text">近3天</span>
                            </span>
                            <span class="choose">
                                <span class="checkboxouter">
                                    <input type="radio" name="time" />
                                    <span class="radio"></span>
                                </span>
                                <span class="text">近一周</span>
                            </span>
                            <span class="choose">
                                <span class="checkboxouter">
                                    <input type="radio" name="time" />
                                    <span class="radio"></span>
                                </span>
                                <span class="text">近一月</span>
                            </span>
                            <span class="choose">
                                <span class="checkboxouter">
                                    <input type="radio" name="time" data-define="define" />
                                    <span class="radio"></span>
                                </span>
                                <span class="text">自定义</span>
                            </span>
                            <span class="define-input">
                            	<input type="text" placeholder="开始时间" />
                                <span class="division"></span>
                                <input type="text" placeholder="结束时间" />
                            </span>
                        </div>
                    </div>
                    <div class="kv-item ue-clear">
                        <label>选择类型:</label>
                        <div class="kv-item-content">
                            <select>
                                <option>全部</option>
                                <option>全部</option>
                                <option>全部</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="search-button">
                	<input class="button" type="button" value="搜索一下" />
                </div>
             </div>-->
             
            <div class="table">
            	<div class="opt ue-clear">
                	<span class="sortarea">
                    	<span class="sort">
                        	<label>排序：</label>
                            <span class="name">
                            	<i class="icon"></i>
                                <span class="text">名称</span>
                            </span>
                        </span>
                        
                        <i class="list"></i>
                        <i class="card"></i>
                    </span>
                	<span class="optarea">
                        <a href="javascript:openMask();" class="add">
                            <i class="icon"></i>
                            <span class="text">添加</span>
                        </a>
                        <a href="javascript:deleteBatch()" class="delete">
                            <i class="icon"></i>
                            <span class="text">删除</span>
                        </a>
                         <a href="javascript:refreshPage()" class="statistics">
                            <i class="icon"></i>
                            <span class="text">刷新</span>
                        </a>
                         <a href="javascript:toggleDiv()" class="config">
                            <i class="icon"></i>
                            <span class="text">搜索</span>
                        </a>
                    </span>
                </div>
                <div class="search" id="search">
                    <input type="text"   style="width: 50px;margin-left:55px" id="uid" >
                    <input type="text"  style="width: 130px;margin-left:10px"  id="username">
                    <input type="text"  style="width: 85px;margin-left:10px"  id="name1">
                    <input type="text"  style="width: 40px;margin-left:10px"  id="sex">
                    <input type="text"  style="width: 180px;margin-left:10px"  id="email">
                    <input type="text"  style="width: 90px;margin-left:10px"  id="birthday" readonly="readonly">
                    <input type="text"  style="width: 130px;margin-left:10px"  id="phone">
                    <input type="text"  style="width: 90px;margin-left:10px"  id="state" placeholder="1:有效 0:无效">
                    <button class="layui-btn layui-btn-sm" onclick="search()">搜索</button>

                </div>
                <div class="grid"></div>
                
                <div class="pagination" id="pagination"></div>
            </div>
        </div>
    </div>
</div>
<div class="ibox-content" style="display: none">
    <form class="form-horizontal m-t" id="commentForm">
        <div class="form-group">
            <label class="col-sm-3 control-label">用户名：</label>
            <div class="col-sm-8">
                <input id="cname" name="name" minlength="2" type="text" class="form-control" required="" aria-required="true">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">姓名：</label>
            <div class="col-sm-8">
                <input id="name" name="name" minlength="2" type="text" class="form-control" required="" aria-required="true">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">E-mail：</label>
            <div class="col-sm-8">
                <input id="cemail" type="email" class="form-control" name="email" required="" aria-required="true">
            </div>
        </div>
        <div class="form-group">
            <div class="col-sm-4 col-sm-offset-3">
                <button class="btn btn-primary" type="submit">提交</button>
            </div>
        </div>
    </form>

</div>
</body>


<script type="text/javascript" th:src="@{/js/jquery.js}"></script>

<script type="text/javascript" th:src="@{/js/global.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.select.js}"></script>
<script type="text/javascript" th:src="@{/js/core.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.pagination.js}"></script>
<script type="text/javascript" th:src="@{/js/jquery.grid.js}"></script>
<script type="text/javascript" th:src="@{/js/WdatePicker.js}"></script>
<scirpt type="text/javascript" th:src="@{/js/pagination.min.js}"></scirpt>
<script type="text/javascript" th:inline="javascript">
	$('select').select();
	var pageNum;
	var pageSize=5;
	var curPage;
	var totalNum;
	var sortName;
	var sortType;
	var searchParameter;
	var head = [{
				label: 'ID',
				width: 50,
				sortable: 'default',
				name: 'uid'
			},{
				label:'用户名',
				width: 150,
				sortable: 'default',
				name:'username'
			},
          {
            label:'姓名',
            width: 100,
            sortable: 'default',
            name:'name'
          }, {
            label:'性别',
            width:50,
            sortable: 'default',
            name:'email'
          },{
				label:'邮箱',
				width:200,
                sortable: 'default',
                name:'email'
			},
        {
            label:'生日',
            width:100,
            sortable: 'default',
            name:'email'
        },
        {
            label:'电话',
            width:150,
            sortable: 'default',
            name:'email'
        },{
				label: '是否有效',
				width:80,
                sortable: 'default',
                name:'state'
			}];
			
	var oper = [{label:'删除',onclick:function(event,index){
	       console.log(index);
            confirmDelete(deleteChoose,index);

				}},{label:'编辑',onclick: function(event,index){

                    var obj=$('.grid').Grid("getTds","uid",index);
                    console.log(obj[0][0]);

                    var id=obj[0].children("div").text();
                layui.use('layer', function(){
                var layer = layui.layer;
                layer.open({
                    type:2,
                    title: '编辑用户'
                    ,content: '/form1?uid='+id,
                    area: ['800px', '500px'],
                    btn:[]
                })

            });

				}}]

    var msg = [[${name}]];

    function goTO(page,pageSize1){

        drawTable(head);
        $('.grid').Grid('addLoading');

        var url="/"+msg+"/"+page+"?pageSize="+pageSize1;
        if(sortName){
            url+='&sortName='+sortName;
        }
        if(sortType){
            if(sortType=="asc") {
                url += '&type=0';
            }else if(sortType=="desc"){
                url += '&type=1';
            }
        }
        console.log(searchParameter);
        if(searchParameter){
            url+=searchParameter;
        }
        var tbody1=[];
        $.ajax({
            url :url,
            dataType:"json",
            success:function(data){
                console.log(data);
                pageNum=data.totalPages;
                pageSize=data.size;
                curPage=data.number;
                totalNum=data.totalElements;
                if(page>0&&page>=pageNum){
                    goTO(pageNum-1,pageSize);
                    return ;
                }
                var content=data.content;
                console.log(content);
                for(var i=0;i<content.length;i++){
                    var one=[content[i].uid,content[i].username,content[i].name,nullTOEmpty(content[i].gender)=="m"?"男":"女",nullTOEmpty(content[i].email),nullTOEmpty(content[i].birthday),nullTOEmpty(content[i].mobile),content[i].state=="1"?"<img class='status' src='/images/right.png' style='width: 20px;height: 20px;'>":"<img class='status' src='/images/wrong.png' style='width: 20px;height: 20px;'>",oper];
                    tbody1.push(one);

                }
                setTableData(tbody1);
                layui.use('laypage', function(){
                    var laypage = layui.laypage;

                    //执行一个laypage实例
                    //完整功能
                    laypage.render({
                        elem: 'pagination'
                        ,count: totalNum,
                        limit:pageSize,
                        curr:curPage+1
                        ,layout: [ 'prev', 'page', 'next','skip', 'count', 'limit'],
                        limits:[5,10,20,50,100]
                        ,jump: function(obj,first){
                            console.log(obj);
                            if(!first){
                                pageSize=obj.limit;
                                goTO(obj.curr-1,obj.limit);
                            }
                        },
                        theme: '#1E9FFF'
                    });
                });

            }

        });
        $(document).on("click",".status",function () {
            var index;
            layui.use('layer', function () {
                var layer = layui.layer;
                index=layer.load(2);

            });
//eg2
          //  var index = layer.load(1); //换了种风格
//eg3
           // var index = layer.load(2, {time: 10*1000}); //又换了种风格，并且设定最长等待10秒
            var uid=$(this).parents("tr").find("td:first-child").find("div").text();
            var _this=$(this);
            if(uid==undefined||uid==null){
                layui.use('layer',function () {
                    var layer=layui.layer;
                    layer.close(index);
                    layer.msg("获取该用户id失败！",{icon:5,time:1000});
                    return false;
                })
            }
            if($(this).attr('src')=="/images/right.png"){
                $.post("/status",{
                    uid:uid,
                    status:0
                },function(data,status){
                    if(status=="success") {
                        if (data.code == 00) {
                            layer.close(index);
                            _this.attr('src', '/images/wrong.png');
                        } else {
                            layui.use('layer', function () {
                                var layer = layui.layer;
                                layer.msg(data.data, {icon: 5});
                                layer.close(index);

                            });
                        }
                    }else{
                        layui.use('layer',function () {

                            var layer=layui.layer;
                            layer.close(index);
                            layer.msg("服务器错误！",{icon:5});
                        });
                    }
                });
            }else{
                $.post("/status",{
                    uid:uid,
                    status:1
                },function(data,status){
                    if(status=="success") {
                        if (data.code == 00) {
                            layer.close(index);
                            _this.attr('src', '/images/right.png');
                        } else {
                            layui.use('layer', function () {
                                var layer = layui.layer;
                                layer.close(index);
                                layer.msg(data.data, {icon: 5});

                            })
                        }
                    }else{
                        layui.use('layer',function () {
                            var layer=layui.layer;
                            layer.close(index);
                            layer.msg("服务器错误！",{icon:5});
                        });
                    }
                });

            }
        });
        function drawTable(head,height) {

            $('.grid').Grid({
                thead: head,
                tbody: null,
                height: "auto",
                checkbox: {
                    single: true

                },
                operator: {
                    type: "normal",
                    width: 100
                },
                sortCallBack: function (name, index, type) {
                    sortName=name;
                    sortType=type;
                    goTO(curPage,pageSize);
                }

            });

        }



        function setTableData(tbody){
            $('.grid').Grid('setData',tbody);
        }

    }
    if(msg!=""){
        goTO(0,5);
    }else{
        layui.use('layer',function () {
            var layer=layui.layer;
            layer.alert("服务器错误！");
        })
    }


	



	$('.search-box input[type=radio]').click(function(e) {
        if($(this).prop('checked')){
			if($(this).attr('data-define') === 'define'){
				$('.define-input').show();
			}else{
				$('.define-input').hide();
			}
		}
    });
    function nullTOEmpty(param){
        if(param==null||param=="null"){
            return "";
        }
        return param;
    }
	function openMask(){
            layui.use('layer', function(){
                var layer = layui.layer;
               var a=layer.open({
                    type:2,
                    title: '添加用户'
                    ,content: 'form1.html',
                     name:'form_add',
                    area: ['800px', '500px'],
                    btn:[]
                })

            });
    }

    function deleteChoose(indexs){
	    if(indexs){}else {
           indexs = $('.grid').Grid("getCheckedIndex");
        }

        var obj=$('.grid').Grid("getTds","uid",indexs);
        var deleteIds=[];

        for(var i=0;i<obj.length;i++){
           deleteIds.push(obj[i].children("div").text());

        }

        if(deleteIds==null||deleteIds==[]||deleteIds.length==0){
            layer.msg("请选择用户！");
            return ;
        }else {
            console.log(JSON.stringify(deleteIds))
            $.ajax({
                contentType:"application/json",
                url: "/deleteUsers",
                data:JSON.stringify(deleteIds),
                type: "post",
                success: function (data) {
                    if (data.code == "00") {
                        goTO(curPage, pageSize);
                    } else {
                        layer.msg(data.data,{icon:5})
                    }
                }
            });
        }
    }
    function refreshPage(){
	    window.location.reload();
    }
    function refreshCurrentPage(){
	    goTO(curPage,pageSize);
    }
    function goToLastPage(){
	    goTO(pageNum,pageSize);
    }
    function toggleDiv() {

        $("#search").toggle();
    }
    function search(){
        console.log($("#state").val());
	    var id=$("#uid").val();
        var username=$("#username").val();
        var name=$("#name1").val();
        var sex=$("#sex").val();
        var birthday=$("#birthday").val();
        var phone=$("#phone").val();

        var state=$("#state").val();
        console.log(state);
        var email=$("#email").val();
	        var search="";
	        if(id!=""){
                search+="&uid="+id;
            }
            if(sex!=""){
	            var para=sex;
	            if(sex=="男"){
                    para="m";
                }else if(sex=="女"){
	                para="f";
                }
	            search+="&gender="+para;
            }
            if(birthday!=""){
	            search+="&birthday="+birthday;
            }
            if(phone!=""){
	            search+="&mobile="+phone;
            }
            if(username!=""){
                search+="&username="+username;
            }
            if(name!=""){
                search+="&name="+name;
            }
            if(email!=""){
                search+="&email="+email;
            }
            if(state!=""){
                search+="&state="+state;
            }
            searchParameter=search;

            goTO(0,pageSize);


    }
    function deleteBatch() {
        confirmDelete(deleteChoose);
    }

    function confirmDelete(callback,targetIndex){
        layui.use('layer',function () {
            var layer=layui.layer;
            layer.confirm("确认删除吗？",{
                yes:function (index) {
                    callback(targetIndex);
                    layer.close(index);
                }
            });
        })
    }
    $('.search input').bind('keypress',function(event){


        if(event.keyCode == 13)

        {
           search();
        }

    });
    $("#birthday").click(function () {
        layui.use("laydate",function () {
            var laydate=layui.laydate;
            console.log(laydate);
            laydate.render({
                elem: '#birthday' ,
                max:0
            });
        })
    })
</script>
</html>
